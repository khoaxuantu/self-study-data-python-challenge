{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "ename": "HTTPError",
     "evalue": "429 Client Error: Too Many Requests for url: https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest?start=95&limit=2&convert=USD",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mHTTPError\u001b[0m                                 Traceback (most recent call last)",
      "Cell \u001b[1;32mIn[5], line 37\u001b[0m\n\u001b[0;32m     35\u001b[0m \u001b[38;5;66;03m# Gửi yêu cầu GET tới API\u001b[39;00m\n\u001b[0;32m     36\u001b[0m response \u001b[38;5;241m=\u001b[39m requests\u001b[38;5;241m.\u001b[39mget(url, headers\u001b[38;5;241m=\u001b[39mheaders, params\u001b[38;5;241m=\u001b[39mparameters)  \n\u001b[1;32m---> 37\u001b[0m \u001b[43mresponse\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mraise_for_status\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m \n\u001b[0;32m     39\u001b[0m \u001b[38;5;66;03m# Phân tích nội dung JSON  \u001b[39;00m\n\u001b[0;32m     40\u001b[0m data \u001b[38;5;241m=\u001b[39m response\u001b[38;5;241m.\u001b[39mjson()  \n",
      "File \u001b[1;32mc:\\Users\\thing\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\requests\\models.py:1021\u001b[0m, in \u001b[0;36mResponse.raise_for_status\u001b[1;34m(self)\u001b[0m\n\u001b[0;32m   1016\u001b[0m     http_error_msg \u001b[38;5;241m=\u001b[39m (\n\u001b[0;32m   1017\u001b[0m         \u001b[38;5;124mf\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;132;01m{\u001b[39;00m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mstatus_code\u001b[38;5;132;01m}\u001b[39;00m\u001b[38;5;124m Server Error: \u001b[39m\u001b[38;5;132;01m{\u001b[39;00mreason\u001b[38;5;132;01m}\u001b[39;00m\u001b[38;5;124m for url: \u001b[39m\u001b[38;5;132;01m{\u001b[39;00m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39murl\u001b[38;5;132;01m}\u001b[39;00m\u001b[38;5;124m\"\u001b[39m\n\u001b[0;32m   1018\u001b[0m     )\n\u001b[0;32m   1020\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m http_error_msg:\n\u001b[1;32m-> 1021\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m HTTPError(http_error_msg, response\u001b[38;5;241m=\u001b[39m\u001b[38;5;28mself\u001b[39m)\n",
      "\u001b[1;31mHTTPError\u001b[0m: 429 Client Error: Too Many Requests for url: https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest?start=95&limit=2&convert=USD"
     ]
    }
   ],
   "source": [
    "import requests\n",
    "import csv\n",
    "from datetime import datetime\n",
    "\n",
    "# API key \n",
    "api_key = 'YOU_MUST_NEVER_PUBLIC_YOUR_API_KEY'  \n",
    "url = 'https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest'  \n",
    "\n",
    "headers = {  \n",
    "    'Accepts': 'application/json',  \n",
    "    'X-CMC_PRO_API_KEY': api_key,  \n",
    "}  \n",
    "\n",
    "with open('crypto_data_api_filtered.csv', 'w', newline='', encoding='utf-8') as csvfile:  \n",
    "    writer = csv.writer(csvfile)  \n",
    "\n",
    "    headers_row = [\n",
    "        'Timestamp', 'Name', 'Price', '1h %', '24h %', '7d %', 'Market Cap', 'Volume (24h)', 'Circulating Supply', 'Last 7 Days'\n",
    "    ]  \n",
    "    writer.writerow(headers_row)  \n",
    "    \n",
    "    start = 1  \n",
    "    limit = 10  \n",
    "\n",
    "    while True:\n",
    "        parameters = {  \n",
    "            'start': str(start),  \n",
    "            'limit': str(limit),  \n",
    "            'convert': 'USD'  \n",
    "        }  \n",
    "\n",
    "        response = requests.get(url, headers=headers, params=parameters)  \n",
    "        response.raise_for_status() \n",
    "\n",
    "        data = response.json()  \n",
    "        cryptos = data['data']  \n",
    "\n",
    "        if not cryptos:\n",
    "            break\n",
    "\n",
    "        # Lấy timestamp hiện tại\n",
    "        timestamp = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n",
    "\n",
    "        for crypto in cryptos:  \n",
    "            last_7_days = f'https://coinmarketcap.com/currencies/{crypto[\"id\"]}/'  # URL của trang thông tin đồng tiền\n",
    "            \n",
    "            row = [  \n",
    "                timestamp,  # Thêm timestamp vào đầu hàng dữ liệu\n",
    "                crypto['name'],  \n",
    "                crypto['quote']['USD']['price'],  \n",
    "                crypto['quote']['USD']['percent_change_1h'],  \n",
    "                crypto['quote']['USD']['percent_change_24h'],  \n",
    "                crypto['quote']['USD']['percent_change_7d'],  \n",
    "                crypto['quote']['USD']['market_cap'],  \n",
    "                crypto['quote']['USD']['volume_24h'],  \n",
    "                crypto['circulating_supply'],  \n",
    "                last_7_days  # URL của biểu đồ giá\n",
    "            ]  \n",
    "            writer.writerow(row)  \n",
    "\n",
    "        # Cập nhật start để lấy trang tiếp theo\n",
    "        start += limit\n",
    "        \n",
    "print(\"Complete convert to csv!!!\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Timestamp</th>\n",
       "      <th>Name</th>\n",
       "      <th>Price</th>\n",
       "      <th>1h %</th>\n",
       "      <th>24h %</th>\n",
       "      <th>7d %</th>\n",
       "      <th>Market Cap</th>\n",
       "      <th>Volume (24h)</th>\n",
       "      <th>Circulating Supply</th>\n",
       "      <th>Last 7 Days</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2024-08-09 12:08:18</td>\n",
       "      <td>Bitcoin</td>\n",
       "      <td>60657.946406</td>\n",
       "      <td>-0.963204</td>\n",
       "      <td>6.550697</td>\n",
       "      <td>-5.742129</td>\n",
       "      <td>1.197233e+12</td>\n",
       "      <td>4.297909e+10</td>\n",
       "      <td>1.973745e+07</td>\n",
       "      <td>https://coinmarketcap.com/currencies/1/</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2024-08-09 12:08:18</td>\n",
       "      <td>Ethereum</td>\n",
       "      <td>2650.584484</td>\n",
       "      <td>-1.525726</td>\n",
       "      <td>9.103193</td>\n",
       "      <td>-16.085412</td>\n",
       "      <td>3.187678e+11</td>\n",
       "      <td>2.278484e+10</td>\n",
       "      <td>1.202632e+08</td>\n",
       "      <td>https://coinmarketcap.com/currencies/1027/</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2024-08-09 12:08:18</td>\n",
       "      <td>Tether USDt</td>\n",
       "      <td>1.000146</td>\n",
       "      <td>0.002057</td>\n",
       "      <td>-0.003422</td>\n",
       "      <td>0.111099</td>\n",
       "      <td>1.154215e+11</td>\n",
       "      <td>7.006400e+10</td>\n",
       "      <td>1.154047e+11</td>\n",
       "      <td>https://coinmarketcap.com/currencies/825/</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2024-08-09 12:08:18</td>\n",
       "      <td>BNB</td>\n",
       "      <td>509.356252</td>\n",
       "      <td>-1.063926</td>\n",
       "      <td>5.039386</td>\n",
       "      <td>-10.925248</td>\n",
       "      <td>7.433377e+10</td>\n",
       "      <td>1.732500e+09</td>\n",
       "      <td>1.459367e+08</td>\n",
       "      <td>https://coinmarketcap.com/currencies/1839/</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2024-08-09 12:08:18</td>\n",
       "      <td>Solana</td>\n",
       "      <td>156.189060</td>\n",
       "      <td>-1.584179</td>\n",
       "      <td>2.324393</td>\n",
       "      <td>-5.087857</td>\n",
       "      <td>7.283709e+10</td>\n",
       "      <td>4.785518e+09</td>\n",
       "      <td>4.663393e+08</td>\n",
       "      <td>https://coinmarketcap.com/currencies/5426/</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2024-08-09 12:08:18</td>\n",
       "      <td>USDC</td>\n",
       "      <td>0.999886</td>\n",
       "      <td>-0.004746</td>\n",
       "      <td>-0.006565</td>\n",
       "      <td>-0.015080</td>\n",
       "      <td>3.449697e+10</td>\n",
       "      <td>8.153961e+09</td>\n",
       "      <td>3.450092e+10</td>\n",
       "      <td>https://coinmarketcap.com/currencies/3408/</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2024-08-09 12:08:18</td>\n",
       "      <td>XRP</td>\n",
       "      <td>0.600691</td>\n",
       "      <td>-2.481820</td>\n",
       "      <td>0.297355</td>\n",
       "      <td>3.398563</td>\n",
       "      <td>3.370137e+10</td>\n",
       "      <td>2.890051e+09</td>\n",
       "      <td>5.610436e+10</td>\n",
       "      <td>https://coinmarketcap.com/currencies/52/</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2024-08-09 12:08:18</td>\n",
       "      <td>Toncoin</td>\n",
       "      <td>6.291495</td>\n",
       "      <td>1.599686</td>\n",
       "      <td>11.594699</td>\n",
       "      <td>-5.056658</td>\n",
       "      <td>1.584410e+10</td>\n",
       "      <td>1.158449e+09</td>\n",
       "      <td>2.518336e+09</td>\n",
       "      <td>https://coinmarketcap.com/currencies/11419/</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>2024-08-09 12:08:18</td>\n",
       "      <td>Dogecoin</td>\n",
       "      <td>0.104242</td>\n",
       "      <td>-1.605121</td>\n",
       "      <td>4.912480</td>\n",
       "      <td>-11.106709</td>\n",
       "      <td>1.516280e+10</td>\n",
       "      <td>7.968899e+08</td>\n",
       "      <td>1.454581e+11</td>\n",
       "      <td>https://coinmarketcap.com/currencies/74/</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>2024-08-09 12:08:18</td>\n",
       "      <td>Cardano</td>\n",
       "      <td>0.345884</td>\n",
       "      <td>-1.673199</td>\n",
       "      <td>3.340799</td>\n",
       "      <td>-9.985731</td>\n",
       "      <td>1.242608e+10</td>\n",
       "      <td>3.215498e+08</td>\n",
       "      <td>3.592559e+10</td>\n",
       "      <td>https://coinmarketcap.com/currencies/2010/</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "             Timestamp         Name         Price      1h %      24h %  \\\n",
       "0  2024-08-09 12:08:18      Bitcoin  60657.946406 -0.963204   6.550697   \n",
       "1  2024-08-09 12:08:18     Ethereum   2650.584484 -1.525726   9.103193   \n",
       "2  2024-08-09 12:08:18  Tether USDt      1.000146  0.002057  -0.003422   \n",
       "3  2024-08-09 12:08:18          BNB    509.356252 -1.063926   5.039386   \n",
       "4  2024-08-09 12:08:18       Solana    156.189060 -1.584179   2.324393   \n",
       "5  2024-08-09 12:08:18         USDC      0.999886 -0.004746  -0.006565   \n",
       "6  2024-08-09 12:08:18          XRP      0.600691 -2.481820   0.297355   \n",
       "7  2024-08-09 12:08:18      Toncoin      6.291495  1.599686  11.594699   \n",
       "8  2024-08-09 12:08:18     Dogecoin      0.104242 -1.605121   4.912480   \n",
       "9  2024-08-09 12:08:18      Cardano      0.345884 -1.673199   3.340799   \n",
       "\n",
       "        7d %    Market Cap  Volume (24h)  Circulating Supply  \\\n",
       "0  -5.742129  1.197233e+12  4.297909e+10        1.973745e+07   \n",
       "1 -16.085412  3.187678e+11  2.278484e+10        1.202632e+08   \n",
       "2   0.111099  1.154215e+11  7.006400e+10        1.154047e+11   \n",
       "3 -10.925248  7.433377e+10  1.732500e+09        1.459367e+08   \n",
       "4  -5.087857  7.283709e+10  4.785518e+09        4.663393e+08   \n",
       "5  -0.015080  3.449697e+10  8.153961e+09        3.450092e+10   \n",
       "6   3.398563  3.370137e+10  2.890051e+09        5.610436e+10   \n",
       "7  -5.056658  1.584410e+10  1.158449e+09        2.518336e+09   \n",
       "8 -11.106709  1.516280e+10  7.968899e+08        1.454581e+11   \n",
       "9  -9.985731  1.242608e+10  3.215498e+08        3.592559e+10   \n",
       "\n",
       "                                   Last 7 Days  \n",
       "0      https://coinmarketcap.com/currencies/1/  \n",
       "1   https://coinmarketcap.com/currencies/1027/  \n",
       "2    https://coinmarketcap.com/currencies/825/  \n",
       "3   https://coinmarketcap.com/currencies/1839/  \n",
       "4   https://coinmarketcap.com/currencies/5426/  \n",
       "5   https://coinmarketcap.com/currencies/3408/  \n",
       "6     https://coinmarketcap.com/currencies/52/  \n",
       "7  https://coinmarketcap.com/currencies/11419/  \n",
       "8     https://coinmarketcap.com/currencies/74/  \n",
       "9   https://coinmarketcap.com/currencies/2010/  "
      ]
     },
     "execution_count": 1,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "\n",
    "# Đọc dữ liệu từ CSV\n",
    "df = pd.read_csv('crypto_data_api_filtered.csv')\n",
    "\n",
    "df.head(10)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
